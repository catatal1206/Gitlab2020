module.exports=function(e){var t={};function i(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(r,s,function(t){return e[t]}.bind(null,s));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=3)}([function(e,t){e.exports=require("vscode")},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),s=i(2);function n(e,t){let i=e.getWordRangeAtPosition(t);return i||(i=e.getWordRangeAtPosition(t,/[^\s]+/)),i}function o(e,t,i=8,s=!0){let n=t.start.with({character:Math.max(0,t.start.character-i)}),o=e.getWordRangeAtPosition(n),a=e.getText(new r.Range(o?o.start:n,t.start)),c=e.getText(t),l=t.end.translate(0,331),d=e.getText(new r.Range(t.end,l));return s&&(a=a.replace(/^\s*/g,""),d=d.replace(/\s*$/g,"")),{before:a,inside:c,after:d}}t.getRequestRange=n,t.getPreviewChunks=o;class a{constructor(e){this.name=e}async set(e){r.commands.executeCommand("setContext",this.name,e)}}t.Context=a,a.IsActive=new a("reference-list.isActive"),a.Source=new a("reference-list.source"),a.HasResult=new a("reference-list.hasResult"),a.HasHistory=new a("reference-list.hasHistory"),a.CallHierarchyMode=new a("references-view.callHierarchyMode");class c{constructor(e,t,i){this.uri=e,this.results=t,this.parent=i}}t.FileItem=c;class l{constructor(e,t){this.location=e,this.parent=t}async getDocument(e){if(this._document||(this._document=r.workspace.openTextDocument(this.location.uri)),e){const e=await this.parent.parent.move(this,!0);e&&!e._document&&this._document.then(()=>e.getDocument(!1))}return this._document}}t.ReferenceItem=l;class d{constructor(e,t,i,s){this.source=e,this.uri=t,this.position=i,this._onDidChange=new r.EventEmitter,this.onDidChange=this._onDidChange.event,this.items=s.then(e=>{const t=[];let i;e.sort(d._compareLocations);for(const r of e)i&&0===d._compareUriIgnoreFragment(i.uri,r.uri)||(i=new c(r.uri.with({fragment:""}),[],this),t.push(i)),i.results.push(new l(r,i));return t})}static create(e,t,i){const s=Promise.resolve(r.commands.executeCommand(i,e,t)).then(e=>null!=e?e:[]);return new d(i,e,t,s)}async asHistoryItem(e){let t;try{t=await r.workspace.openTextDocument(this.uri)}catch(e){return}const i=n(t,this.position);if(!i)return;let{before:a,inside:c,after:l}=o(t,i);a=a.replace(/s$/g,String.fromCharCode(160)),l=l.replace(/^s/g,String.fromCharCode(160));let d=a+c+l,m="vscode.executeImplementationProvider"===this.source?"implementations":"references";return new s.HistoryItem(s.HistoryItem.makeId(this.source,this.uri,this.position),c,`${r.workspace.asRelativePath(this.uri)} • ${d} • ${m}`,"references-view.refindReference",e,this.uri,new s.WordAnchor(t,this.position))}async total(){let e=0;for(const t of await this.items)e+=t.results.length;return e}async get(e){for(const t of await this.items)if(t.uri.toString()===e.toString())return t}async first(){const e=await this.items;if(0===e.length)return;for(const t of e)if(t.uri.toString()===this.uri.toString()){for(const e of t.results)if(e.location.range.contains(this.position))return e;let e;for(const i of t.results){if(i.location.range.end.isAfter(this.position))return i;e=i}if(e)return e;break}let t=0,i=d._prefixLen(e[t].toString(),this.uri.toString());for(let r=1;r<e.length;r++){d._prefixLen(e[r].uri.toString(),this.uri.toString())>i&&(t=r)}return e[t].results[0]}async remove(e){e instanceof c?(d._del(await this.items,e),this._onDidChange.fire(this)):e instanceof l&&(d._del(e.parent.results,e),0===e.parent.results.length?(d._del(await this.items,e.parent),this._onDidChange.fire(this)):this._onDidChange.fire(e.parent))}async move(e,t){const i=await this.items,r=t?1:-1,s=e=>{const t=(i.indexOf(e)+r+i.length)%i.length;return i[t]};if(e instanceof c)return t?s(e).results[0]:d._tail(s(e).results);if(e instanceof l){const t=e.parent.results.indexOf(e)+r;return t<0?d._tail(s(e.parent).results):t>=e.parent.results.length?s(e.parent).results[0]:e.parent.results[t]}}static _compareUriIgnoreFragment(e,t){let i=e.with({fragment:""}).toString(),r=t.with({fragment:""}).toString();return i<r?-1:i>r?1:0}static _compareLocations(e,t){return e.uri.toString()<t.uri.toString()?-1:e.uri.toString()>t.uri.toString()?1:e.range.start.isBefore(t.range.start)?-1:e.range.start.isAfter(t.range.start)?1:0}static _prefixLen(e,t){let i=0;for(;i<e.length&&i<t.length&&e.charCodeAt(i)===t.charCodeAt(i);)i+=1;return i}static _del(e,t){const i=e.indexOf(t);i>=0&&e.splice(i,1)}static _tail(e){return e[e.length-1]}}t.ReferencesModel=d;class m{constructor(e,t=1){this._mem=e,this._value=t;const i=e.get(m._key);this.value="number"==typeof i&&i>=0&&i<=1?i:t}get value(){return this._value}set value(e){this._value=e,a.CallHierarchyMode.set(0===this._value?"showIncoming":"showOutgoing"),this._mem.update(m._key,e)}}t.RichCallsDirection=m,m._key="references-view.callHierarchyMode";class h{constructor(e,t,i){this.item=e,this.parent=t,this.locations=i}}t.CallItem=h;class u{constructor(e,t,i){this.uri=e,this.position=t,this.direction=i,this.source="callHierarchy",this.roots=Promise.resolve(r.commands.executeCommand("vscode.prepareCallHierarchy",e,t)).then(e=>e?e.map(e=>new h(e,void 0,void 0)):[])}async resolveCalls(e){if(0===this.direction){const t=await r.commands.executeCommand("vscode.provideIncomingCalls",e.item);return t?t.map(t=>new h(t.from,e,t.fromRanges.map(e=>new r.Location(t.from.uri,e)))):[]}{const t=await r.commands.executeCommand("vscode.provideOutgoingCalls",e.item);return t?t.map(t=>new h(t.to,e,t.fromRanges.map(t=>new r.Location(e.item.uri,t)))):[]}}changeDirection(){return new u(this.uri,this.position,0===this.direction?1:0)}async isEmpty(){return 0===(await this.roots).length}async first(){const[e]=await this.roots;return e}async asHistoryItem(e){const[t]=await this.roots,i=0===this.direction?"calls from":"callers of";return new s.HistoryItem(s.HistoryItem.makeId(t.item.uri,t.item.selectionRange.start.line,t.item.selectionRange.start.character,this.direction),t.item.name,`${r.workspace.asRelativePath(this.uri)} • ${i}`,"references-view.showCallHierarchy",e,this.uri,new s.WordAnchor(await r.workspace.openTextDocument(this.uri),this.position))}}t.CallsModel=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),s=i(1);t.WordAnchor=class{constructor(e,t){this._doc=e,this._position=t,this._version=e.version,this._word=this._getAnchorWord(e,t)}_getAnchorWord(e,t){const i=e.getWordRangeAtPosition(t)||e.getWordRangeAtPosition(t,/[^\s]+/);return i&&e.getText(i)}getPosition(){if(!this._word)return this._position;if(this._version===this._doc.version)return this._position;const e=this._getAnchorWord(this._doc,this._position);if(this._word===e)return this._position;const t=this._position.line;let i,s,n=0;do{if(s=!1,i=t+n,i<this._doc.lineCount){s=!0;let e=this._doc.lineAt(i).text.indexOf(this._word);if(e>=0)return new r.Position(i,e)}if(n+=1,i=t-n,i>=0){s=!0;let e=this._doc.lineAt(i).text.indexOf(this._word);if(e>=0)return new r.Position(i,e)}}while(n<100&&s);return this._position}};t.HistoryItem=class{constructor(e,t,i,r,s,n,o){this.id=e,this.label=t,this.description=i,this.commandId=r,this.extraArgs=s,this.uri=n,this.anchor=o}static makeId(...e){let t="";for(const i of e)t+=JSON.stringify(i);return Buffer.from(t).toString("base64")}};class n{constructor(){this._items=new Map}get isEmpty(){return 0==this._items.size}*[Symbol.iterator](){let e=[...this._items.values()];for(let t=e.length-1;t>=0;t--)yield e[t]}add(e){e&&(this._items.delete(e.id),this._items.set(e.id,e),s.Context.HasHistory.set(!0))}get(e){return this._items.get(e)}clear(){this._items.clear(),s.Context.HasHistory.set(!1)}}t.History=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),s=i(4),n=i(2),o=i(1),a=i(5);t.activate=function(e){const t=new o.RichCallsDirection(e.globalState),i=new n.History,c=new a.TreeDataProviderWrapper,l="references-view.tree",d=r.window.createTreeView(l,{treeDataProvider:c,showCollapseAll:!0}),m=new s.EditorHighlights(d);let h;r.window.onDidChangeActiveTextEditor(()=>d.visible&&m.show(),void 0,e.subscriptions),d.onDidChangeVisibility(e=>e.visible?m.show():m.hide(),void 0,e.subscriptions);const u=async e=>{var t;h=e,d.message=void 0,m.setModel(h),o.Context.HasResult.set(Boolean(h)),o.Context.Source.set(null===(t=h)||void 0===t?void 0:t.source),(async()=>{await o.Context.IsActive.set(!0),await r.commands.executeCommand(l+".focus")})(),c.update(e||i),e?await g():f()},f=()=>{let e;e=i.isEmpty?"No results.":"No results. Try running a previous search again:",d.message=e,d.title="Results"},g=async()=>{if(h instanceof o.ReferencesModel){const e=await h.total(),t=(await h.items).length;d.message=1===e&&1===t?`${e} result in ${t} file`:1===e?`${e} result in ${t} files`:1===t?`${e} results in ${t} file`:`${e} results in ${t} files`,"vscode.executeReferenceProvider"===h.source?d.title=`Results (${e})`:"vscode.executeImplementationProvider"===h.source&&(d.title=`Implementations (${e})`)}else h instanceof o.CallsModel?(0===h.direction?d.title="Callers Of":d.title="Calls From",d.message=""):(d.message=void 0,d.title="Results")},v=async e=>{if(await u(e),e){if(0===(await e.items).length)return void await u(void 0);const t=await e.first();t&&d.visible&&d.reveal(t,{select:!0,focus:!0}),i.add(await e.asHistoryItem([e.source]))}},p=async(e,t,i)=>{let s;if(t instanceof r.Uri&&i instanceof r.Position)s=o.ReferencesModel.create(t,i,e);else if(r.window.activeTextEditor){let t=r.window.activeTextEditor;o.getRequestRange(t.document,t.selection.active)&&(s=o.ReferencesModel.create(t.document.uri,t.selection.active,e))}v(s)},w=e=>{e instanceof n.HistoryItem&&r.commands.executeCommand(e.commandId,...e.extraArgs,e.uri,e.anchor.getPosition())},_=async(e=t.value,s,n)=>{let a;if(s instanceof r.Uri&&n instanceof r.Position)a=new o.CallsModel(s,n,e);else if(r.window.activeTextEditor){let t=r.window.activeTextEditor;o.getRequestRange(t.document,t.selection.active)&&(a=new o.CallsModel(t.document.uri,t.selection.active,e))}if(await u(a),a instanceof o.CallsModel){if(await a.isEmpty())return void await u(void 0);const e=await a.first();e&&d.visible&&d.reveal(e,{select:!0,focus:!0,expand:!0}),i.add(await a.asHistoryItem([a.direction]))}},y=async(e,i)=>(t.value=e,i instanceof o.CallItem?_(e,i.item.uri,i.item.selectionRange.start):h instanceof o.CallsModel?_(e,h.uri,h.position):void 0),C=(e,t)=>{let i,s,a=!t;if(e instanceof o.ReferenceItem){const{location:t}=e;i=t.uri,s=t.range.start}else e instanceof o.CallItem?(i=e.item.uri,s=e.item.selectionRange.start):e instanceof n.HistoryItem&&(i=e.uri,s=e.anchor.getPosition(),a=!1);if(i&&s)return r.commands.executeCommand("vscode.open",i,{selection:new r.Range(s,s),preserveFocus:a})},b=async e=>{if(!(h instanceof o.ReferencesModel))return;const t=d.selection[0]||h.first();if(t instanceof n.HistoryItem||t instanceof o.CallItem)return;const i=await h.move(t,e);i&&(d.reveal(i,{select:!0}),C(i,!0))},I=async e=>{let t="",i=[e];for(;i.length>0;){let e=i.pop();if(e instanceof o.ReferencesModel)i.push(...(await e.items).slice(0,99));else if(e instanceof o.ReferenceItem){let i=await e.getDocument(),r=o.getPreviewChunks(i,e.location.range,21,!1);t+=`  ${e.location.range.start.line+1}, ${e.location.range.start.character+1}: ${r.before+r.inside+r.after} \n`}else e instanceof o.FileItem&&(t+=r.workspace.asRelativePath(e.uri)+" \n",i.push(...e.results))}t&&await r.env.clipboard.writeText(t)},x=async(e,t,i)=>{await v(new o.ReferencesModel("vscode.executeReferenceProvider",e,t,Promise.resolve(i)))};let R;const T="references.preferredLocation";function D(e){if(e&&!e.affectsConfiguration(T))return;const t=r.workspace.getConfiguration().get(T);R&&(R.dispose(),R=void 0),"view"===t&&(R=r.commands.registerCommand("editor.action.showReferences",x))}D(),e.subscriptions.push(d,r.workspace.onDidChangeConfiguration(D),r.commands.registerCommand("references-view.find",()=>p("vscode.executeReferenceProvider")),r.commands.registerCommand("references-view.findImplementations",()=>p("vscode.executeImplementationProvider")),r.commands.registerCommand("references-view.refindReference",p),r.commands.registerCommand("references-view.showCallHierarchy",()=>_()),r.commands.registerCommand("references-view.showOutgoingCalls",e=>y(1,e)),r.commands.registerCommand("references-view.showIncomingCalls",e=>y(0,e)),r.commands.registerCommand("references-view.refind",w),r.commands.registerCommand("references-view.refresh",async()=>{const[e]=i;e&&w(e)}),r.commands.registerCommand("references-view.clear",async()=>{await u(void 0)}),r.commands.registerCommand("references-view.clearHistory",async()=>{i.clear(),await u(void 0)}),r.commands.registerCommand("references-view.show",C),r.commands.registerCommand("references-view.remove",async e=>{var t;if(h instanceof o.ReferencesModel){let i;e instanceof o.ReferenceItem&&(i=await h.move(e,!0),(null===(t=i)||void 0===t?void 0:t.parent)!==e.parent&&(i=void 0)),await h.remove(e),m.refresh(),g(),i&&d.reveal(i,{select:!0})}}),r.commands.registerCommand("references-view.next",()=>b(!0)),r.commands.registerCommand("references-view.prev",()=>b(!1)),r.commands.registerCommand("references-view.copy",I),r.commands.registerCommand("references-view.copyAll",()=>I(h)),r.commands.registerCommand("references-view.copyPath",e=>{e instanceof o.FileItem&&("file"===e.uri.scheme?r.env.clipboard.writeText(e.uri.fsPath):r.env.clipboard.writeText(e.uri.toString(!0)))}),r.commands.registerCommand("references-view.pickFromHistory",async()=>{const e=[...i].map(e=>({label:e.label,description:e.description,item:e})),t=await r.window.showQuickPick(e,{placeHolder:"Select previous reference search"});t&&await w(t.item)}))}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),s=i(1);t.EditorHighlights=class{constructor(e){this._view=e,this._decorationType=r.window.createTextEditorDecorationType({backgroundColor:new r.ThemeColor("editor.findMatchHighlightBackground"),rangeBehavior:r.DecorationRangeBehavior.ClosedClosed,overviewRulerLane:r.OverviewRulerLane.Center,overviewRulerColor:new r.ThemeColor("editor.findMatchHighlightBackground")}),this._ignore=new Set}setModel(e){this._model=e,this._ignore.clear(),this._listener&&this._listener.dispose(),e instanceof s.ReferencesModel?this._listener=r.workspace.onDidChangeTextDocument(async t=>{this._ignore.add(await e.get(t.document.uri))}):e instanceof s.CallsModel&&(this._listener=this._view.onDidChangeSelection(()=>{this.show()})),this.show()}async show(){const{activeTextEditor:e}=r.window;if(e&&e.viewColumn){const t=[];if(this._model instanceof s.ReferencesModel){const i=await this._model.get(e.document.uri);i&&!this._ignore.has(i)&&t.push(...i.results.map(e=>e.location.range))}else if(this._model instanceof s.CallsModel){const[i]=this._view.selection;if(i instanceof s.CallItem){let s=i.locations;s||(s=[new r.Location(i.item.uri,i.item.selectionRange)]);for(const i of s)i.uri.toString()===e.document.uri.toString()&&t.push(i.range)}}e.setDecorations(this._decorationType,t)}}hide(){for(const e of r.window.visibleTextEditors)e.setDecorations(this._decorationType,[])}refresh(){this.hide(),this.show()}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),s=i(1);class n{constructor(e){this._model=e,this._onDidChangeTreeData=new r.EventEmitter,this.onDidChangeTreeData=this._onDidChangeTreeData.event,this._modelListener=e.onDidChange(e=>this._onDidChangeTreeData.fire(e instanceof s.FileItem?e:void 0))}dispose(){this._onDidChangeTreeData.dispose(),this._modelListener.dispose()}async getTreeItem(e){if(e instanceof s.FileItem){const t=new r.TreeItem(e.uri);return t.contextValue="file-item",t.description=!0,t.iconPath=r.ThemeIcon.File,t.collapsibleState=r.TreeItemCollapsibleState.Collapsed,t}{const{range:t}=e.location,i=await e.getDocument(!0),{before:n,inside:o,after:a}=s.getPreviewChunks(i,t),c={label:n+o+a,highlights:[[n.length,n.length+o.length]]},l=new r.TreeItem2(c);return l.collapsibleState=r.TreeItemCollapsibleState.None,l.contextValue="reference-item",l.command={command:"references-view.show",title:"Open Reference",arguments:[e]},l}}async getChildren(e){return e?e instanceof s.FileItem?e.results:void 0:this._model.items}getParent(e){return e instanceof s.ReferenceItem?e.parent:void 0}}t.ReferencesProvider=n;class o{constructor(e){this._model=e,this._emitter=new r.EventEmitter,this.onDidChangeTreeData=this._emitter.event}getTreeItem(e){const t=new r.TreeItem(e.item.name);return t.description=e.item.detail,t.contextValue="call-item",t.iconPath=o._getThemeIcon(e.item.kind),t.command={command:"references-view.show",title:"Open Call",arguments:[e]},t.collapsibleState=r.TreeItemCollapsibleState.Collapsed,t}getChildren(e){return e?this._model.resolveCalls(e):this._model.roots}getParent(e){return e.parent}static _getThemeIcon(e){let t=o._themeIconIds[e];return t&&new r.ThemeIcon(t)}}t.CallItemDataProvider=o,o._themeIconIds=["symbol-file","symbol-module","symbol-namespace","symbol-package","symbol-class","symbol-method","symbol-property","symbol-field","symbol-constructor","symbol-enum","symbol-interface","symbol-function","symbol-variable","symbol-constant","symbol-string","symbol-number","symbol-boolean","symbol-array","symbol-object","symbol-key","symbol-null","symbol-enum-member","symbol-struct","symbol-event","symbol-operator","symbol-type-parameter"];class a{constructor(e){this._history=e,this._emitter=new r.EventEmitter,this.onDidChangeTreeData=this._emitter.event}getTreeItem(e){const t=new r.TreeItem(e.label);return t.description=e.description,t.command={command:"references-view.show",arguments:[e],title:"Show"},t.collapsibleState=r.TreeItemCollapsibleState.None,t.contextValue="history-item",t}getChildren(){return[...this._history]}getParent(){}}t.HistoryDataProvider=a;t.TreeDataProviderWrapper=class{constructor(){this._onDidChange=new r.EventEmitter,this.onDidChangeTreeData=this._onDidChange.event}update(e){this._providerListener&&(this._providerListener.dispose(),this._providerListener=void 0),this._provider&&"function"==typeof this._provider.dispose&&(this._provider.dispose(),this._provider=void 0),e instanceof s.ReferencesModel?this._provider=new n(e):e instanceof s.CallsModel?this._provider=new o(e):this._provider=new a(e),this._onDidChange.fire(),this._providerListener=this._provider.onDidChangeTreeData(e=>this._onDidChange.fire(e))}getTreeItem(e){return this._provider.getTreeItem(e)}getChildren(e){var t;return null===(t=this._provider)||void 0===t?void 0:t.getChildren(e)}getParent(e){var t;return null===(t=this._provider)||void 0===t?void 0:t.getParent(e)}}}]);
//# sourceMappingURL=extension.js.map